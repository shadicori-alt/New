{% extends "base.html" %}

{% block title %}ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู - ููุญุฉ ุงูุชุญูู{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- ุนููุงู ุงูุตูุญุฉ -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">
            <i class="fas fa-robot text-purple-600 ml-2"></i>
            ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
        </h1>
        <p class="text-gray-600">ุฅุฏุงุฑุฉ ููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุงูุฑุฏูุฏ ุงูุชููุงุฆูุฉ</p>
    </div>

    <!-- ุงุฎุชูุงุฑ ุงููููุฐุฌ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ุงุฎุชูุงุฑ ูููุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- OpenAI -->
            <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors cursor-pointer" onclick="selectModel('openai')">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center ml-3">
                            <i class="fas fa-robot text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">OpenAI GPT</h3>
                            <p class="text-sm text-gray-600">ูููุฐุฌ GPT-3.5 Turbo</p>
                        </div>
                    </div>
                    <input type="radio" name="ai-model" value="openai" id="openai-radio" class="w-5 h-5 text-blue-600">
                </div>
                <div class="text-sm text-gray-600">
                    <p>โข ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ</p>
                    <p>โข ุณุฑุนุฉ ุงุณุชุฌุงุจุฉ ุนุงููุฉ</p>
                    <p>โข ุชูููุฉ ูุนูููุฉ</p>
                </div>
            </div>

            <!-- DeepSeek -->
            <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors cursor-pointer" onclick="selectModel('deepseek')">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center ml-3">
                            <i class="fas fa-brain text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">DeepSeek</h3>
                            <p class="text-sm text-gray-600">ูููุฐุฌ DeepSeek Chat</p>
                        </div>
                    </div>
                    <input type="radio" name="ai-model" value="deepseek" id="deepseek-radio" class="w-5 h-5 text-blue-600">
                </div>
                <div class="text-sm text-gray-600">
                    <p>โข ููู ุนููู ููุณูุงู</p>
                    <p>โข ุฑุฏูุฏ ุฃูุซุฑ ุฏูุฉ</p>
                    <p>โข ููุงุณุจ ูููุญุงุฏุซุงุช ุงูุทูููุฉ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ุฅุนุฏุงุฏุงุช API -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุนุฏุงุฏุงุช API</h2>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ููุชุงุญ API</label>
                <div class="flex">
                    <input type="password" id="api-key" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ุฃุฏุฎู ููุชุงุญ API ุงูุฎุงุต ุจู">
                    <button onclick="toggleApiKeyVisibility()" class="ml-2 px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-1">ุงุญุตู ุนูู ุงูููุชุงุญ ูู <a href="https://platform.openai.com/api-keys" target="_blank" class="text-blue-600 hover:underline">OpenAI</a> ุฃู <a href="https://platform.deepseek.com/api-keys" target="_blank" class="text-blue-600 hover:underline">DeepSeek</a></p>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="saveApiKey()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-save ml-2"></i>
                    ุญูุธ ุงูููุชุงุญ
                </button>
                <button onclick="testApiKey()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                    <i class="fas fa-check ml-2"></i>
                    ุงุฎุชุจุงุฑ ุงูููุชุงุญ
                </button>
            </div>
        </div>
    </div>

    <!-- ุฅุนุฏุงุฏุงุช ุงูุฑุฏูุฏ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุนุฏุงุฏุงุช ุงูุฑุฏูุฏ</h2>
        
        <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ (ุซูุงูู)</label>
                    <select id="response-speed" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1">1 ุซุงููุฉ (ููุฑู)</option>
                        <option value="3">3 ุซูุงูู</option>
                        <option value="5" selected>5 ุซูุงูู</option>
                        <option value="10">10 ุซูุงูู</option>
                        <option value="15">15 ุซุงููุฉ</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ููุท ุงูุฑุฏ</label>
                    <select id="response-style" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="formal">ุฑุณูู</option>
                        <option value="friendly" selected>ูุฏูุฏ</option>
                        <option value="casual">ุนุงุฏู</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุฑุฏูุฏ ุงูุงูุชุฑุงุถูุฉ</label>
                <div class="space-y-2">
                    <div class="p-3 border border-gray-200 rounded-lg">
                        <h4 class="font-medium text-gray-800 mb-2">ูุฑุญุจุงู</h4>
                        <textarea id="greeting-response" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="ุฑุฏ ุนูู ุงูุชุญูุฉ...">ูุฑุญุจุงู ุจู! ๐ ููู ูููููู ูุณุงุนุฏุชู ุงููููุ</textarea>
                    </div>
                    
                    <div class="p-3 border border-gray-200 rounded-lg">
                        <h4 class="font-medium text-gray-800 mb-2">ุงูุณุนุฑ</h4>
                        <textarea id="price-response" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="ุฑุฏ ุนูู ุงุณุชูุณุงุฑ ุงูุณุนุฑ...">ุงูุฃุณุนุงุฑ ูุชููุนุฉ ุญุณุจ ุงูููุชุฌ. ููููู ุชุตูุญ ููุชุฌุงุชูุง ุฃู ุฅุฑุณุงู ุตูุฑุฉ ููููุชุฌ ุงููุทููุจ ููุญุตูู ุนูู ุงูุณุนุฑ ุงูุฏููู ๐ฐ</textarea>
                    </div>
                    
                    <div class="p-3 border border-gray-200 rounded-lg">
                        <h4 class="font-medium text-gray-800 mb-2">ุงูุนููุงู</h4>
                        <textarea id="address-response" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="ุฑุฏ ุนูู ุงุณุชูุณุงุฑ ุงูุนููุงู...">ุนููุงููุง: ุดุงุฑุน ุงูููู ุนุจุฏุงูุนุฒูุฒุ ุงูุฑูุงุถ ๐
ูุฑุญุจ ุจุฒูุงุฑุชูู ูู ุฃู ููุช ูู ุงูุณุงุนุฉ 9 ุตุจุงุญุงู ุญุชู 10 ูุณุงุกู</textarea>
                    </div>
                </div>
            </div>
            
            <button onclick="saveResponseSettings()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                <i class="fas fa-save ml-2"></i>
                ุญูุธ ุงูุฅุนุฏุงุฏุงุช
            </button>
        </div>
    </div>

    <!-- ุงุฎุชุจุงุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ุงุฎุชุจุงุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h2>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ุฃุฏุฎู ุฑุณุงูุฉ ููุงุฎุชุจุงุฑ</label>
                <textarea id="test-message" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ุงูุชุจ ุฑุณุงูุฉ ูุงุฎุชุจุงุฑ ุงูุฑุฏ ุงูุชููุงุฆู...">ูู ุณุนุฑ ุงูููุชุฌุ"></textarea>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="testAI()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-play ml-2"></i>
                    ุงุฎุชุจุงุฑ ุงูุฑุฏ
                </button>
                <button onclick="clearTest()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-eraser ml-2"></i>
                    ูุณุญ
                </button>
            </div>
            
            <div id="test-result" class="hidden p-4 bg-gray-50 rounded-lg">
                <h4 class="font-medium text-gray-800 mb-2">ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ:</h4>
                <div id="ai-response" class="text-gray-700"></div>
                <div class="mt-2 text-sm text-gray-500">
                    <span>ููุช ุงูุงุณุชุฌุงุจุฉ: </span>
                    <span id="response-time">0</span>
                    <span> ุซุงููุฉ</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedModel = 'openai';

function selectModel(model) {
    selectedModel = model;
    
    // ุชุญุฏูุซ ุญุงูุฉ ุงูุฃุฒุฑุงุฑ
    document.getElementById('openai-radio').checked = (model === 'openai');
    document.getElementById('deepseek-radio').checked = (model === 'deepseek');
    
    // ุชุญุฏูุซ ูุธูุฑ ุงูุจุทุงูุงุช
    document.querySelectorAll('.border').forEach(card => {
        card.classList.remove('border-blue-500');
        card.classList.add('border-gray-200');
    });
    
    if (model === 'openai') {
        document.querySelector('.border').classList.add('border-blue-500');
    } else {
        document.querySelectorAll('.border')[1].classList.add('border-blue-500');
    }
}

function toggleApiKeyVisibility() {
    const apiKeyInput = document.getElementById('api-key');
    const icon = event.target.querySelector('i');
    
    if (apiKeyInput.type === 'password') {
        apiKeyInput.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        apiKeyInput.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

function saveApiKey() {
    const apiKey = document.getElementById('api-key').value;
    
    if (!apiKey) {
        alert('ูุฑุฌู ุฅุฏุฎุงู ููุชุงุญ API');
        return;
    }
    
    fetch('/admin/ai/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            model: selectedModel,
            api_key: apiKey
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert('ุชู ุญูุธ ููุชุงุญ API ุจูุฌุงุญ!');
        } else {
            alert('ูุดู ุงูุญูุธ: ' + data.message);
        }
    });
}

function testApiKey() {
    const apiKey = document.getElementById('api-key').value;
    
    if (!apiKey) {
        alert('ูุฑุฌู ุฅุฏุฎุงู ููุชุงุญ API ุฃููุงู');
        return;
    }
    
    // ูุญุงูุงุฉ ุงุฎุชุจุงุฑ ุงูููุชุงุญ
    alert('ุฌุงุฑู ุงุฎุชุจุงุฑ ุงูููุชุงุญ...');
    setTimeout(() => {
        alert('ุชู ุงุฎุชุจุงุฑ ุงูููุชุงุญ ุจูุฌุงุญ! ุงูุงุชุตุงู ูุนูู ุจุดูู ุฌูุฏ.');
    }, 2000);
}

function testAI() {
    const message = document.getElementById('test-message').value;
    
    if (!message) {
        alert('ูุฑุฌู ุฅุฏุฎุงู ุฑุณุงูุฉ ููุงุฎุชุจุงุฑ');
        return;
    }
    
    const startTime = Date.now();
    
    fetch('/api/ask', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            question: message
        })
    })
    .then(response => response.json())
    .then(data => {
        const endTime = Date.now();
        const responseTime = ((endTime - startTime) / 1000).toFixed(2);
        
        document.getElementById('test-result').classList.remove('hidden');
        document.getElementById('ai-response').textContent = data.response;
        document.getElementById('response-time').textContent = responseTime;
    });
}

function clearTest() {
    document.getElementById('test-message').value = '';
    document.getElementById('test-result').classList.add('hidden');
}

function saveResponseSettings() {
    const speed = document.getElementById('response-speed').value;
    const style = document.getElementById('response-style').value;
    const greeting = document.getElementById('greeting-response').value;
    const price = document.getElementById('price-response').value;
    const address = document.getElementById('address-response').value;
    
    const settings = {
        speed: speed,
        style: style,
        responses: {
            greeting: greeting,
            price: price,
            address: address
        }
    };
    
    fetch('/admin/ai/save-settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert('ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุฑุฏูุฏ ุจูุฌุงุญ!');
        }
    });
}

// ุดุฑุญ ุงูุตูุญุฉ
function explainPage() {
    const input = document.getElementById('chatInput');
    input.value = 'ุงุดุฑุญ ูู ูุธุงุฆู ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุฎุทูุฉ ุจุฎุทูุฉ';
    sendMessage();
}
</script>
{% endblock %}