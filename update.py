#!/usr/bin/env python3
"""
ูุธุงู ุชุญุฏูุซ ุชููุงุฆู
ููุชุญูู ูู ูุฌูุฏ ุชุญุฏูุซุงุช ูุชุญุฏูุซ ุงููุธุงู
"""

import os
import sys
import requests
import json
import subprocess
from datetime import datetime

def check_for_updates():
    """ุงูุชุญูู ูู ูุฌูุฏ ุชุญุฏูุซุงุช"""
    print("๐ ุฌุงุฑู ุงูุชุญูู ูู ูุฌูุฏ ุชุญุฏูุซุงุช...")
    
    # ูุญุงูุงุฉ ูุญุต ุงูุชุญุฏูุซุงุช
    # ูู ุงููุงูุนุ ููุง ูุฌุจ ุงูุงุชุตุงู ุจุฎุงุฏู ุงูุชุญุฏูุซุงุช
    
    current_version = "1.0.0"
    latest_version = "1.0.0"  # ูุญุงูุงุฉ - ูุง ุชูุฌุฏ ุชุญุฏูุซุงุช
    
    print(f"๐ฑ ุงูุฅุตุฏุงุฑ ุงูุญุงูู: {current_version}")
    print(f"๐ ุฃุญุฏุซ ุฅุตุฏุงุฑ: {latest_version}")
    
    if current_version == latest_version:
        print("โ ุงููุธุงู ูุญุฏุซ ุจุงููุนู")
        return False
    else:
        print(f"โ๏ธ  ุชูุฌุฏ ูุณุฎุฉ ุฌุฏูุฏุฉ: {latest_version}")
        return True

def download_update():
    """ุชุญููู ุงูุชุญุฏูุซ"""
    print("๐ฅ ุฌุงุฑู ุชุญููู ุงูุชุญุฏูุซ...")
    
    # ูุญุงูุงุฉ ุชุญููู ุงูุชุญุฏูุซ
    print("โ ุชู ุชุญููู ุงูุชุญุฏูุซ ุจูุฌุงุญ")
    return True

def apply_update():
    """ุชุทุจูู ุงูุชุญุฏูุซ"""
    print("๐ง ุฌุงุฑู ุชุทุจูู ุงูุชุญุฏูุซ...")
    
    try:
        # ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        backup_dir = f"backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        os.makedirs(backup_dir, exist_ok=True)
        
        # ูุณุฎ ุงููููุงุช ุงููููุฉ
        important_files = ['data.db', 'app.py', 'core.py', 'db.py']
        for file in important_files:
            if os.path.exists(file):
                import shutil
                shutil.copy2(file, backup_dir)
        
        print(f"๐พ ุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู: {backup_dir}")
        
        # ูุญุงูุงุฉ ุชุทุจูู ุงูุชุญุฏูุซ
        print("โ ุชู ุชุทุจูู ุงูุชุญุฏูุซ ุจูุฌุงุญ")
        
        return True
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุชุทุจูู ุงูุชุญุฏูุซ: {e}")
        return False

def restart_system():
    """ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู"""
    print("๐ ุฌุงุฑู ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู...")
    
    try:
        # ุฅููุงู ุงูุชุทุจูู ุงูุญุงูู
        print("โน๏ธ  ุฅููุงู ุงูุชุทุจูู ุงูุญุงูู...")
        
        # ุฅุนุงุฏุฉ ุงูุชุดุบูู
        print("โถ๏ธ  ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู...")
        os.execv(sys.executable, [sys.executable, 'run.py'])
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุนุงุฏุฉ ุงูุชุดุบูู: {e}")
        print("๐ก ูุฑุฌู ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู ูุฏููุงู")

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ููุชุญุฏูุซ"""
    print("๐ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู")
    print("=" * 40)
    print("๐ก ุงููุณุฎุฉ ุงูุญุงููุฉ: 2.0 - ุงููุณุฎุฉ ุงููุตุฑูุฉ ุงูุฐููุฉ")
    print("โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ:")
    print("   โข ุณูุงูุงุช ุฐูุงุก ุงุตุทูุงุนู ูุชุนุฏุฏุฉ")
    print("   โข ููุชุจุงุช ูุนุฑูุฉ ูุตุฑูุฉ ูุฅุฏุงุฑูุฉ")
    print("   โข ุชูุงูู ูุงูู ูุน Shopify")
    print("   โข ุชูุงุฑูุฑ ุชููุงุฆูุฉ ูููุงุชุณุงุจ")
    print("   โข ูุณุงุนุฏ ุฐูู ูุญุณูู")
    print("=" * 40)
    
    # ุงูุชุญูู ูู ุงูุชุญุฏูุซุงุช
    if not check_for_updates():
        return
    
    # ุณุคุงู ุงููุณุชุฎุฏู
    choice = input("\nูู ุชุฑูุฏ ุชุญููู ูุชุทุจูู ุงูุชุญุฏูุซุ (y/n): ").lower()
    
    if choice != 'y':
        print("โ ุชู ุฅูุบุงุก ุงูุชุญุฏูุซ")
        return
    
    # ุชุญููู ุงูุชุญุฏูุซ
    if not download_update():
        print("โ ูุดู ุชุญููู ุงูุชุญุฏูุซ")
        return
    
    # ุชุทุจูู ุงูุชุญุฏูุซ
    if not apply_update():
        print("โ ูุดู ุชุทุจูู ุงูุชุญุฏูุซ")
        return
    
    # ุฅุนุงุฏุฉ ุงูุชุดุบูู
    restart_choice = input("\nูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู ุงูุขูุ (y/n): ").lower()
    
    if restart_choice == 'y':
        restart_system()
    else:
        print("๐ก ูุฑุฌู ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู ูุงุญูุงู ูุชุทุจูู ุงูุชุญุฏูุซ")

if __name__ == '__main__':
    main()